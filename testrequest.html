
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Wikipedia Lookup</title>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
</head>
<body>
<style type="text/css">
  div.fsb {
    border:1px solid #000;
    background-color:white;
    width:200px;
    height:28px;
    padding:1px;
  }
 
  div.fortschritt {
    background-color:#000;
    height:28px;
    width:0%; /* Fortschritt */
  }
</style>
<script type="text/javascript"><!--
var searched='';
var workingon='';
var wikicheck = function (data) {
	//In data[0] liegt das angefragte Element
	//In data[1] liegt das Array mit den gefundenen Begriffen
	//console.log(data[1]);
	var found = false;
    	var url='';
	//Ergebnis der Wikianfrage
	var text = data [0];
	//Hole die Eingabe
	//var input_text = document.getElementById ('spellcheckinput').value;
	var input_text = workingon;
	//Bereinige die Eingabe
	input_text = input_text.replace(/\s/g, "");
	//console.log(input_text);

	//if (text != input_text)
	//	return;

	for (i=0; i<data [1].length; i++) {
		//Gehe die Ergebnisliste durch und prüfe ob das Wort genau übereinstimmt
		if (text.toLowerCase () == data [1] [i].toLowerCase ()) {
			found = true;
			//Pruefe ob erster Buchstabe groß ist, nur dann soll etwas passieren
			if (text.toLowerCase () != text) {
				url ='http://de.wikipedia.org/wiki/' + text;
				//document.getElementById ('spellcheckresult').innerHTML = '<b style="color:green">Begriff gefunden</b> - <a target="_new" href="' + url + '">' + text + '</a>';
				//document.getElementById ('resulttext').innerHTML = searched + '<a target="_new" href="' + url + '">' + text + '</a>';
				searched = searched + '<a target="_new" href="' + url + '">' + text + '</a>' + ' ';
			}
			else {
				//document.getElementById ('spellcheckresult').innerHTML = '<b style="color:red">Begriff nicht gefunden</b> - ' + text + '';
				//document.getElementById ('resulttext').innerHTML = searched + text + ' ';
				searched = searched +  text + ' ';
			}
		}
	}
	//Wenn keines der Ergebnisse passt, dann füge den Text unformatiert wieder ein
	if (! found) {
		//document.getElementById ('spellcheckresult').innerHTML = '<b style="color:red">Begriff nicht gefunden</b> - ' + text + '';
		//document.getElementById ('resulttext').innerHTML = searched + text + ' ';
		searched = searched +  text + ' ';
	}
	//console.log(searched);
	
	//Leere das Eingabefeld
	//document.getElementById ('spellcheckinput').value = '';
};

var checkavailability = function (value) {
	//console.log(value);
	//if (! value)
	//	return;
	//Entferne Leerzeichen
	value = value.replace(/\s/g, "");
	//Aktualisiere workingon
	workingon = value;

	url = 'http://de.wikipedia.org/w/api.php?action=opensearch&search='+value+'&format=json&callback=wikicheck';
	//Connect to wiki
	var elem = document.createElement ('script');
	elem.setAttribute ('src', url);
	elem.setAttribute ('type','text/javascript');
	document.getElementsByTagName ('head') [0].appendChild (elem);
	//console.log(document.getElementsByTagName ('head') [0]);
};

function sleep(miliseconds, status) {
           var currentTime = new Date().getTime();
		   //document.getElementById ('statusbar').innerHTML = status;
           while (currentTime + miliseconds >= new Date().getTime()) {
           }
       };
var splitstrings = function (stringinput) {
	var wiki_task = setInterval(function(){run_wiki()},100);

	if (!stringinput)
		return;
	var string_splitted = stringinput.split(" ");
	var i = 0;
	var length = string_splitted.length;
	function run_wiki() {
		if (i<length) {
			checkavailability (string_splitted[i]);
			var prog = Math.round((i/string_splitted.length)*100);
			write_progress (prog);
			document.getElementById('prg_bar').style.width = prog + '%';
			i=i+1;
		}
		else {
			document.getElementById ('resulttext').innerHTML = searched;
			clearInterval(wiki_task);
			write_progress (100);
		}
	};
};

var write_progress = function (progress) {
	document.getElementById ('statusbar').innerHTML = progress + '/100';
};

var clearresult = function () {
	document.getElementById ('resulttext').innerHTML = '';
	searched = '';
};
--></script>
<form action="#" method="get" onsubmit="return false">
<p>Geben Sie den Text ein: - 
	<input id="spellcheckinput" type="text"> 
	<button name="Start_lookup" onclick="splitstrings (spellcheckinput.value);"><p>Start lookup</p></button>
	<button name="Clear_result" onclick="clearresult ();"><p>Clear Result</p></button>
	<span id="spellcheckresult"></span>
</p>
</form>
<div class="fsb">
  <div class="fortschritt" id ="prg_bar"></div>
</div>
<span id="statusbar">0/100</span><br>
<span id="resulttext">Hier steht Text</span><br>
<span id="debug"></span>
</body>
</html>

